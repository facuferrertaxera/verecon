<mvc:View controllerName="tech.taxera.taxreporting.verecon.controller.Main"
    xmlns:mvc="sap.ui.core.mvc" displayBlock="true"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core"
    xmlns:layout="sap.ui.layout"
    xmlns:st="sap.ui.comp.smarttable"
    xmlns:sfb="sap.ui.comp.smartfilterbar"
    xmlns:sv="sap.ui.comp.smartvariants"
    xmlns:vhd="sap.ui.comp.valuehelpdialog"
    xmlns:customData="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1">
    <f:DynamicPage id="dynamicPageId" class="sapUiNoContentPadding" headerExpanded="{view>/reconciliationList/headerExpanded}" busyIndicatorDelay="{view>/busyIndicatorDelay}">
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <sv:SmartVariantManagement id="tech.taxera.taxreporting.verecon.rlmv.id" persistencyKey="tech.taxera.taxreporting.verecon.rlmv.pk" showShare="true" showExecuteOnSelection="true" entitySet="Reconciliation">
                        <sv:personalizableControls>
                            <sv:PersonalizableInfo
                                dataSource="Reconciliation"
                                control="reconciliationsTable"
                                keyName="persistencyKey"
                                type="table"
                            />
                            <sv:PersonalizableInfo
                                dataSource="Reconciliation"
                                control="smartFilterBar"
                                keyName="persistencyKey"
                                type="filterBar"
                            />
                        </sv:personalizableControls>
                    </sv:SmartVariantManagement>
                </f:heading>
                <f:snappedContent>
                    <Text id="statusText"></Text>
                </f:snappedContent>

                <f:actions>
                    <Button text="{i18n>reconciliationList.Create}" icon="sap-icon://add" type="Emphasized" press="onReconciliationCreate"/>
                </f:actions>

            </f:DynamicPageTitle>
        </f:title>

        <!-- DynamicPage Header -->
        <f:header>
            <f:DynamicPageHeader pinnable="true">
                <f:content>
                    <sfb:SmartFilterBar id="smartFilterBar" useProvidedNavigationProperties="true" liveMode="true" smartVariant="tech.taxera.taxreporting.verecon.rlmv.id" useToolbar="false" entitySet="Reconciliation" persistencyKey="tech.taxera.taxreporting.verecon.rlmv.pk" assignedFiltersChanged="onAssignedFiltersChanged" enableBasicSearch="false">
                        <sfb:controlConfiguration>
                            <sfb:ControlConfiguration key="CountryList" visibleInAdvancedArea="false" visible="true" mandatory="optional" label="{i18n>reconciliationList.CountryList}">
                                <sfb:customControl>
                                    <MultiInput id="countryListFilter" valueHelpRequest="onCountryValueHelpRequest" showValueHelp="true" placeholder="{i18n>reconciliationList.SelectCountries}"/>
                                </sfb:customControl>
                            </sfb:ControlConfiguration>
                            <sfb:ControlConfiguration key="CompanyCodeList" visibleInAdvancedArea="false" visible="true" mandatory="optional" label="{i18n>reconciliationList.CompanyCodeList}">
                                <sfb:customControl>
                                    <MultiInput id="companyCodeListFilter" valueHelpRequest="onCompanyCodeValueHelpRequest" showValueHelp="true" placeholder="{i18n>reconciliationList.SelectCompanyCodes}"/>
                                </sfb:customControl>
                            </sfb:ControlConfiguration>
                            <sfb:ControlConfiguration key="ConvCreatedAt" label="{i18n>reconciliationList.CreatedAt}" conditionType="{
                                module: 'sap.ui.comp.config.condition.DateRangeType',
                                ignoreTime: false
                            }" visibleInAdvancedArea="true">
                            </sfb:ControlConfiguration>
                        </sfb:controlConfiguration>
                        <!-- layout data used to make the table growing but the filter bar fixed -->
                        <sfb:layoutData>
                            <FlexItemData shrinkFactor="0"/>
                        </sfb:layoutData>
                        <sfb:dependents>
                            <!-- Value Help Dialog for Countries -->
                            <vhd:ValueHelpDialog id="countryValueHelpDialog" 
                                title="{i18n>reconciliationList.SelectCountries}"
                                ok="onCountryValueHelpOk"
                                cancel="onCountryValueHelpCancel"
                                afterClose="onCountryValueHelpAfterClose"
                                key="Country"
                                descriptionKey="Country_Text"
                                supportMultiselect="true"/>
                            
                            <!-- Value Help Dialog for Company Codes -->
                            <vhd:ValueHelpDialog id="companyCodeValueHelpDialog" 
                                title="{i18n>reconciliationList.SelectCompanyCodes}"
                                ok="onCompanyCodeValueHelpOk"
                                cancel="onCompanyCodeValueHelpCancel"
                                afterClose="onCompanyCodeValueHelpAfterClose"
                                key="CompanyCode"
                                descriptionKey="Name"
                                supportMultiselect="true"/>
                        </sfb:dependents>
                    </sfb:SmartFilterBar>
                </f:content>
            </f:DynamicPageHeader>
        </f:header>
        <f:content>
            <st:SmartTable id="reconciliationsTable" 
            placeToolbarInTable="true"
            smartVariant="tech.taxera.taxreporting.verecon.rlmv.id" beforeRebindTable="onBeforeRebindTable" persistencyKey="tech.taxera.taxreporting.verecon.rlmv.pk" entitySet="Reconciliation" smartFilterId="smartFilterBar" tableType="ResponsiveTable" useExportToExcel="true" useVariantManagement="true" enableAutoBinding="true" requestAtLeastFields="Id,CountryList,CompanyCodeList,FromDate,ToDate,CreatedBy,ConvCreatedAt,Status,StatusText,LastChangedBy,ConvLastChangedAt" useTablePersonalisation="true" showRowCount="true">
                <st:layoutData>
                    <FlexItemData growFactor="1" baseSize="0%"/>
                </st:layoutData>
                <st:customToolbar>
                    <OverflowToolbar design="Transparent">
                        <ToolbarSpacer/>
                        <OverflowToolbarToggleButton tooltip="{i18n>reconciliationList.Edit}" text="{i18n>reconciliationList.Edit}" icon="sap-icon://edit" pressed="{view>/reconciliationList/bEditMode}"/>
                        <OverflowToolbarButton icon="sap-icon://delete" tooltip="{i18n>reconciliationList.Delete}" press="onDeleteReconciliation" enabled="{= ${view>/reconciliationList/bEditMode} &amp;&amp; ${view>/reconciliationList/bDeleteEnabled} }"/>
                    </OverflowToolbar>
                </st:customToolbar>
                <Table id="reconcilesTable" sticky="ColumnHeaders,HeaderToolbar" mode="{= ${view>/reconciliationList/bEditMode} ? 'SingleSelectLeft' : 'None'}" selectionChange="onSelectReconciliation" growing="true" growingScrollToLoad="true" growingThreshold="100">
                    <columns>
                        <Column>
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "CountryList","columnIndex":"0", "leadingProperty": "CountryList", "filterProperty": "CountryList", "sortProperty": "CountryList", "type": "string"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationList.CountryList}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Tablet">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "CompanyCodeList","columnIndex":"1", "leadingProperty": "CompanyCodeList", "filterProperty": "CompanyCodeList", "sortProperty": "CompanyCodeList", "type": "string"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationList.CompanyCodeList}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Tablet">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "FromDate","columnIndex":"2", "leadingProperty": "FromDate", "filterProperty": "FromDate", "sortProperty": "FromDate", "type": "date"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationList.FromDate}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Tablet">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "ToDate","columnIndex":"3", "leadingProperty": "ToDate", "filterProperty": "ToDate", "sortProperty": "ToDate", "type": "date"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationList.ToDate}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Tablet">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "CreatedBy","columnIndex":"4", "leadingProperty": "CreatedByName", "filterProperty": "CreatedByName", "sortProperty": "CreatedByName", "type": "string"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationList.CreatedBy}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Tablet">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "ConvCreatedAt","columnIndex":"5", "leadingProperty": "ConvCreatedAt", "filterProperty": "ConvCreatedAt", "sortProperty": "ConvCreatedAt", "type": "date"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationList.CreatedAt}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "Status","columnIndex":"6", "leadingProperty": "Status", "filterProperty": "Status", "sortProperty": "Status", "type": "string"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationList.Status}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "LastChangedBy","columnIndex":"7", "leadingProperty": "LastChangedByName", "filterProperty": "LastChangedByName", "sortProperty": "LastChangedByName", "type": "string"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationList.LastChangedBy}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "ConvLastChangedAt","columnIndex":"8", "leadingProperty": "ConvLastChangedAt", "filterProperty": "ConvLastChangedAt", "sortProperty": "ConvLastChangedAt", "type": "date"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationList.LastChangedAt}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "Actions","columnIndex":"9"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationList.Actions}"/>
                        </Column>
                    </columns>
                    <items>
                        <ColumnListItem type="Navigation" press="onReconciliationPress">
                            <cells>
                                <Tokenizer editable="false" tokens="{path: 'CountryList', formatter: '.formatter.formatCountryListToTokens'}" class="sapUiTinyMargin"/>
                                <Tokenizer editable="false" tokens="{path: 'CompanyCodeList', formatter: '.formatter.formatCompanyCodeListToTokens'}" class="sapUiTinyMargin"/>
                                <Text text="{path: 'FromDate', type: '.types.TaxeraDateType'}"/>
                                <Text text="{path: 'ToDate', type: '.types.TaxeraDateType'}"/>
                                <Text text="{CreatedByName}"/>
                                <Text text="{path: 'ConvCreatedAt', type: '.types.TaxeraDateTimeType'}"/>
                                <ObjectStatus inverted="false" text="{StatusText}" icon="{path: 'Status', formatter: '.formatter.formatStatusIcon' }" state="{path: 'Status', formatter: '.formatter.formatStatusColor' }"/>
                                <Text text="{LastChangedByName}"/>
                                <Text text="{path: 'ConvLastChangedAt', type: '.types.TaxeraDateTimeType'}"/>
                                <HBox wrap='Wrap'>
                                    <Button class="sapUiTinyMarginEnd" type="Emphasized" icon="sap-icon://action" tooltip="{i18n>reconciliationList.ViewDetails}" press="onViewReconciliationDetails"/>
                                </HBox>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
            </st:SmartTable>
        </f:content>
    </f:DynamicPage>
</mvc:View>