<mvc:View controllerName="tech.taxera.taxreporting.verecon.controller.ReconciliationDetail"
    xmlns:mvc="sap.ui.core.mvc" displayBlock="true"
    xmlns="sap.m"
    xmlns:smartform="sap.ui.comp.smartform"
    xmlns:smartField="sap.ui.comp.smartfield"
    xmlns:form="sap.ui.layout.form"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core"
    xmlns:layout="sap.ui.layout"
    xmlns:cssgrid="sap.ui.layout.cssgrid"
    xmlns:smartTable="sap.ui.comp.smarttable"
    xmlns:st="sap.ui.comp.smarttable"
    xmlns:sv="sap.ui.comp.smartvariants"
    xmlns:smartFilterBar="sap.ui.comp.smartfilterbar" 
    xmlns:table="sap.ui.table"
    xmlns:m="sap.m"
    xmlns:smartVariant="sap.ui.comp.smartvariants.SmartVariantManagement"
    xmlns:mc="sap.suite.ui.microchart"
    xmlns:customData="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1">
    <f:DynamicPage headerExpanded="{view>/reconciliationDetail/headerExpanded}" toggleHeaderOnTitleClick="{view>/reconciliationDetail/titleClickable}" class="sapUiNoContentPadding" height="100%">
        <!-- DynamicPage Header -->
        <f:header>
            <f:DynamicPageHeader pinnable="true">
                <f:content>
                    <!-- Charts for reconciliation overview -->
                    <cssgrid:CSSGrid
                        gridTemplateColumns="repeat(12, 1fr)"
                        gridGap="1.5rem"
                        width="100%"
                        class="sapUiNoContentPadding sapUiSmallMarginBeginEnd"
                        visible="{view>/reconciliationDetail/chartFiltersVisible}">
                        
                        <!-- Reconciliation Details Card -->
                        <f:Card class="sapUiNoContentPadding" height="220px">
                            <f:layoutData>
                                <cssgrid:GridItemLayoutData gridColumn="span 3" />
                            </f:layoutData>
                            <f:content>
                                <VBox class="sapUiSmallMargin" width="100%">
                                    <Title text="{i18n>reconciliationDetail.ReconciliationDetails}" titleStyle="H6" class="sapUiTinyMarginBottom" />
                                    <HBox width="100%" justifyContent="SpaceBetween" alignItems="Center" class="sapUiSmallMarginBottom">
                                        <Label text="{i18n>reconciliationList.CountryList}" design="Bold" />
                                        <VBox width="100%" class="sapUiTinyMarginBegin" alignItems="End">
                                            <Tokenizer id="reconciliationCountryListTokenizer" editable="false" width="100%" multiLine="true"/>
                                        </VBox>
                                    </HBox>
                                    <HBox width="100%" justifyContent="SpaceBetween" alignItems="Center" class="sapUiSmallMarginBottom">
                                        <Label text="{i18n>reconciliationList.CompanyCodeList}" design="Bold" />
                                        <VBox width="100%" class="sapUiTinyMarginBegin" alignItems="End">
                                            <Tokenizer id="reconciliationCompanyCodeListTokenizer" editable="false" width="100%" multiLine="true"/>
                                        </VBox>
                                    </HBox>
                                    <HBox width="100%" justifyContent="SpaceBetween" alignItems="End">
                                        <Label text="{i18n>reconciliationDetail.DateRange}" design="Bold" />
                                        <Text text="{path: 'FromDate', type: '.types.TaxeraDateType'} - {path: 'ToDate', type: '.types.TaxeraDateType'}" class="sapUiTinyMarginBegin"/>
                                    </HBox>
                                </VBox>
                            </f:content>
                        </f:Card>
                        
                        <!-- Document Status Donut Chart Card -->
                        <f:Card class="sapUiNoContentPadding" height="220px">
                            <f:layoutData>
                                <cssgrid:GridItemLayoutData gridColumn="span 3" />
                            </f:layoutData>
                            <f:content>
                                <VBox class="sapUiSmallMargin" width="100%" height="100%">
                                    <Title text="{i18n>reconciliationDetail.DocumentStatus}" titleStyle="H6" class="sapUiTinyMarginBottom" />
                                    <HBox width="100%" height="100%" alignItems="Center" justifyContent="Center">
                                        <mc:InteractiveDonutChart 
                                            id="documentStatusDonutChart"
                                            selectionChanged="onDonutChartSelectionChanged"
                                            displayedSegments="4"
                                            segments="{view>/reconciliationDetail/donutChartData/segments}">
                                            <mc:segments>
                                                <mc:InteractiveDonutChartSegment 
                                                    label="{view>label}" 
                                                    value="{view>value}" 
                                                    displayedValue="{view>displayedValue}" />
                                            </mc:segments>
                                        </mc:InteractiveDonutChart>
                                    </HBox>
                                </VBox>
                            </f:content>
                        </f:Card>
                        
                        <!-- Documents not in EC Sales List Card -->
                        <f:Card id="notInEcslCard" height="220px" press="onStatusCardPress" semanticRole="ListItem">
                            <f:layoutData>
                                <cssgrid:GridItemLayoutData gridColumn="span 2" />
                            </f:layoutData>
                            <f:customData>
                                <core:CustomData key="statusFilter" value="NOT_IN_ECSL" />
                            </f:customData>
                            <f:content>
                                <VBox width="100%" height="100%" class="sapUiSmallMargin statusCardContent">
                                    <Title text="{i18n>reconciliationDetail.NotInEcsl}" titleStyle="H6" class="sapUiTinyMarginBottom" />
                                    <VBox justifyContent="Center" alignItems="Center" width="100%" class="statusCardValueContainer">
                                        <Text 
                                            text="{path: 'view>/reconciliationDetail/statusCards/notInEcsl/total', formatter: '.formatter.formatNumberWithScale'}" 
                                            class="statusCardValue" />
                                        <Text 
                                            text="{path: 'view>/reconciliationDetail/statusCards/notInEcsl/count', formatter: '.formatter.formatDocCount'}" 
                                            class="statusCardCountText" />
                                    </VBox>
                                </VBox>
                            </f:content>
                        </f:Card>
                        
                        <!-- Documents not in VAT Return Card -->
                        <f:Card id="notInVatrCard" height="220px" press="onStatusCardPress" semanticRole="ListItem">
                            <f:layoutData>
                                <cssgrid:GridItemLayoutData gridColumn="span 2" />
                            </f:layoutData>
                            <f:customData>
                                <core:CustomData key="statusFilter" value="NOT_IN_VATR" />
                            </f:customData>
                            <f:content>
                                <VBox width="100%" height="100%" class="sapUiSmallMargin statusCardContent">
                                    <Title text="{i18n>reconciliationDetail.NotInVatr}" titleStyle="H6" class="sapUiTinyMarginBottom" />
                                    <VBox justifyContent="Center" alignItems="Center" width="100%" class="statusCardValueContainer">
                                        <Text 
                                            text="{path: 'view>/reconciliationDetail/statusCards/notInVatr/total', formatter: '.formatter.formatNumberWithScale'}" 
                                            class="statusCardValue" />
                                        <Text 
                                            text="{path: 'view>/reconciliationDetail/statusCards/notInVatr/count', formatter: '.formatter.formatDocCount'}" 
                                            class="statusCardCountText" />
                                    </VBox>
                                </VBox>
                            </f:content>
                        </f:Card>
                        
                        <!-- Total Difference Card -->
                        <f:Card id="totalDifferenceCard" height="220px" press="onTotalDifferenceCardPress" semanticRole="ListItem">
                            <f:layoutData>
                                <cssgrid:GridItemLayoutData gridColumn="span 2" />
                            </f:layoutData>
                            <f:content>
                                <VBox width="100%" height="100%" class="sapUiSmallMargin totalDifferenceCardContent">
                                    <Title text="{i18n>reconciliationDetail.TotalDifference}" titleStyle="H6" class="sapUiTinyMarginBottom" />
                                    <VBox justifyContent="Center" alignItems="Center" width="100%" class="totalDifferenceValueContainer">
                                        <Text 
                                            text="{path: 'view>/reconciliationDetail/totalDifference/value', formatter: '.formatter.formatNumberWithScale'}" 
                                            class="totalDifferenceValue" />
                                        <Text 
                                            text="{path: 'view>/reconciliationDetail/totalDifference/count', formatter: '.formatter.formatDocCount'}" 
                                            class="statusCardCountText" />
                                    </VBox>
                                </VBox>
                            </f:content>
                        </f:Card>
                        
                    </cssgrid:CSSGrid>
                </f:content>
            </f:DynamicPageHeader>
        </f:header>
        <f:content>
            <st:SmartTable
                id="documentsSmartTable"
                entitySet="DocumentSUM"
                tableType="AnalyticalTable"
                useExportToExcel="true"
                useVariantManagement="false"
                enableAutoBinding="false"
                useTablePersonalisation="true"
                showRowCount="true"
                showTablePersonalisation="true"
                initialise="true"
                beforeRebindTable="onBeforeRebindDocumentsTable"
                requestAtLeastFields="CompanyCode,Box,DocumentNo,TaxCode,Currencycode,VatrBaseAmount,VatrTaxAmount,VatrGrossAmount,EcslBaseAmount,EcslTaxAmount,EcslGrossAmount,DiffBaseAmount,DiffGrossAmount,Status,StatusText"
                class="sapUiNoContentPadding"
                height="100%">
                    <st:customToolbar>
                        <OverflowToolbar design="Transparent">
                            <Title text="{i18n>reconciliationDetail.Documents}" titleStyle="H3"/>
                            <ToolbarSpacer />
                        </OverflowToolbar>
                    </st:customToolbar>
                </st:SmartTable>
        </f:content>
    </f:DynamicPage>
</mvc:View>
