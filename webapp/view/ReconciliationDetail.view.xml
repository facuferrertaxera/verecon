<mvc:View controllerName="tech.taxera.taxreporting.verecon.controller.ReconciliationDetail"
    xmlns:mvc="sap.ui.core.mvc" displayBlock="true"
    xmlns="sap.m"
    xmlns:smartform="sap.ui.comp.smartform"
    xmlns:smartField="sap.ui.comp.smartfield"
    xmlns:form="sap.ui.layout.form"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core"
    xmlns:layout="sap.ui.layout"
    xmlns:cssgrid="sap.ui.layout.cssgrid"
    xmlns:smartTable="sap.ui.comp.smarttable"
    xmlns:smartFilterBar="sap.ui.comp.smartfilterbar" 
    xmlns:table="sap.ui.table"
    xmlns:smartVariant="sap.ui.comp.smartvariants.SmartVariantManagement"
    xmlns:mc="sap.suite.ui.microchart"
    xmlns:customData="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1">
    <f:DynamicPage headerExpanded="{view>/reconciliationDetail/headerExpanded}" toggleHeaderOnTitleClick="{view>/reconciliationDetail/titleClickable}" class="sapUiNoContentPadding">
        <f:title>
            <f:DynamicPageTitle>
                <f:snappedContent>
                    <Text id="statusText"></Text>
                </f:snappedContent>
                <f:navigationActions>
                    <Button
                        icon="sap-icon://decline"
                        type="Transparent"
                        press="onCloseDetail" />
                </f:navigationActions>
            </f:DynamicPageTitle>
        </f:title>
        <!-- DynamicPage Header -->
        <f:header>
            <f:DynamicPageHeader pinnable="true">
                <f:content>
                    <!-- Charts for reconciliation overview -->
                    <cssgrid:CSSGrid
                        gridTemplateColumns="repeat(12, 1fr)"
                        gridGap="1rem"
                        width="100%"
                        class="sapUiNoContentPadding"
                        visible="{view>/reconciliationDetail/chartFiltersVisible}">
                        
                        <!-- Status per Country Chart Card -->
                        <f:Card>
                            <f:layoutData>
                                <cssgrid:GridItemLayoutData gridColumn="span 3" />
                            </f:layoutData>
                            <f:content>
                                <VBox class="sapUiSmallMargin" height="{view>/reconciliationDetail/donutHeight}">
                                    <Label text="{i18n>reconciliationDetail.StatusPerCountry}" class="smallLabel sapUiSmallMarginTopBottom" />
                                    <mc:InteractiveDonutChart 
                                        selectionEnabled="true" 
                                        displayedSegments="{= ${view>/reconciliationDetail/selectedCountry} === 'RO' ? 7 : 6}" 
                                        id="statusDonut" 
                                        selectionChanged="onSelectStatus" 
                                        showError="{view>/reconciliationDetail/bChartShowError}" 
                                        segments="{ path : 'view>/reconciliationDetail/headerFilters/statusDonutChart/segments' , factory: '.createDonutSegments'}" />
                                </VBox>
                            </f:content>
                        </f:Card>
                        
                        <!-- Document Types per Country Chart Card -->
                        <f:Card>
                            <f:layoutData>
                                <cssgrid:GridItemLayoutData gridColumn="span 4" />
                            </f:layoutData>
                            <f:content>
                                <VBox class="sapUiSmallMargin">
                                    <Label text="{i18n>reconciliationDetail.DocTypesPerCountry}" class="smallLabel sapUiSmallMarginTopBottom" />
                                    <mc:InteractiveBarChart
                                        id="documentTypeBarChart"
                                        labelWidth="30%"
                                        selectionChanged="onSelectDocumentTypeFilter"
                                        showError="{view>/reconciliationDetail/bChartShowError}"
                                        displayedBars="4"
                                        bars="{ 
                                            path : 'view>/reconciliationDetail/headerFilters/documentTypeBarChart/bars' , factory: '.createBars'
                                        }"
                                    />
                                </VBox>
                            </f:content>
                        </f:Card>
                        
                        <!-- Submitted Documents per Month Chart Card -->
                        <f:Card>
                            <f:layoutData>
                                <cssgrid:GridItemLayoutData gridColumn="span 5" />
                            </f:layoutData>
                            <f:content>
                                <VBox class="sapUiSmallMargin" height="150px">
                                    <Label text="{i18n>reconciliationDetail.SubmittedDocumentsPerMonth}" class="smallLabel sapUiSmallMarginTopBottom" />
                                    <mc:InteractiveLineChart 
                                        id="submissionDateLineChart" 
                                        selectionChanged="onSelectSubmittedMonthFilter" 
                                        showError="{view>/reconciliationDetail/bChartShowError}" 
                                        points="{ path : 'view>/reconciliationDetail/headerFilters/submissionDateLineChart/points' , factory: '.createPoints'}" />
                                </VBox>
                            </f:content>
                        </f:Card>
                        
                    </cssgrid:CSSGrid>
                </f:content>
            </f:DynamicPageHeader>
        </f:header>
        <f:content>
            <smartTable:SmartTable showDetailsButton="true" id="documentsSTable" entitySet="Document" beforeRebindTable="onBeforeRebind" tableType="Table" useVariantManagement="true" useTablePersonalisation="true" requestAtLeastFields="DocId"
                header="{i18n>reconciliationDetail.Documents}" persistencyKey="ReconciliationDetailTableKey" enableAutoBinding="false" customizeConfig="{'autoColumnWidth': {'*': {'min': 5, 'max': 10, 'gap': 2, 'truncateLabel': false}}}" enableAutoColumnWidth="true">
                <Table
                    id="documentsTable"
                    sticky="ColumnHeaders,HeaderToolbar"
                    growing="true"
                    growingScrollToLoad="true"
                    growingThreshold="100">
                    
                    <columns>
                        <Column demandPopin="true" minScreenWidth="Tablet">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "CompanyCode","columnIndex":"1", "leadingProperty": "CompanyCode", "filterProperty": "CompanyCode", "sortProperty": "CompanyCode", "type": "string"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.CompanyCode}"/>
                        </Column>
                        <Column>
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "DocumentNo","columnIndex":"2", "leadingProperty": "DocumentNo", "filterProperty": "DocumentNo", "sortProperty": "DocumentNo", "type": "string"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.DocumentNo}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Tablet">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "FiscalYear","columnIndex":"3", "leadingProperty": "FiscalYear", "filterProperty": "FiscalYear", "sortProperty": "FiscalYear", "type": "string"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.FiscalYear}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Tablet">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "PostingDate","columnIndex":"4", "leadingProperty": "PostingDate", "filterProperty": "PostingDate", "sortProperty": "PostingDate", "type": "date"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.PostingDate}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Tablet">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "TaxCode","columnIndex":"5", "leadingProperty": "TaxCode", "filterProperty": "TaxCode", "sortProperty": "TaxCode", "type": "string"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.TaxCode}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Tablet">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "Currencycode","columnIndex":"6", "leadingProperty": "Currencycode", "filterProperty": "Currencycode", "sortProperty": "Currencycode", "type": "string"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.Currency}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop" hAlign="End" width="8rem">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "VatrBaseAmount","columnIndex":"7", "leadingProperty": "VatrBaseAmount", "filterProperty": "VatrBaseAmount", "sortProperty": "VatrBaseAmount", "type": "decimal"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.VatrBaseAmount}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop" hAlign="End" width="8rem">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "VatrTaxAmount","columnIndex":"8", "leadingProperty": "VatrTaxAmount", "filterProperty": "VatrTaxAmount", "sortProperty": "VatrTaxAmount", "type": "decimal"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.VatrTaxAmount}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop" hAlign="End" width="8rem">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "VatrGrossAmount","columnIndex":"9", "leadingProperty": "VatrGrossAmount", "filterProperty": "VatrGrossAmount", "sortProperty": "VatrGrossAmount", "type": "decimal"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.VatrGrossAmount}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop" hAlign="End" width="8rem">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "EcslBaseAmount","columnIndex":"10", "leadingProperty": "EcslBaseAmount", "filterProperty": "EcslBaseAmount", "sortProperty": "EcslBaseAmount", "type": "decimal"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.EcslBaseAmount}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop" hAlign="End" width="8rem">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "EcslTaxAmount","columnIndex":"11", "leadingProperty": "EcslTaxAmount", "filterProperty": "EcslTaxAmount", "sortProperty": "EcslTaxAmount", "type": "decimal"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.EcslTaxAmount}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop" hAlign="End" width="8rem">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "EcslGrossAmount","columnIndex":"12", "leadingProperty": "EcslGrossAmount", "filterProperty": "EcslGrossAmount", "sortProperty": "EcslGrossAmount", "type": "decimal"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.EcslGrossAmount}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop" hAlign="End" width="8rem">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "DiffBaseAmount","columnIndex":"13", "leadingProperty": "DiffBaseAmount", "filterProperty": "DiffBaseAmount", "sortProperty": "DiffBaseAmount", "type": "decimal"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.DiffBaseAmount}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop" hAlign="End" width="8rem">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "DiffTaxAmount","columnIndex":"14", "leadingProperty": "DiffTaxAmount", "filterProperty": "DiffTaxAmount", "sortProperty": "DiffTaxAmount", "type": "decimal"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.DiffTaxAmount}"/>
                        </Column>
                        <Column demandPopin="true" minScreenWidth="Desktop" hAlign="End" width="8rem">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "DiffGrossAmount","columnIndex":"15", "leadingProperty": "DiffGrossAmount", "filterProperty": "DiffGrossAmount", "sortProperty": "DiffGrossAmount", "type": "decimal"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.DiffGrossAmount}"/>
                        </Column>
                        <Column width="auto" hAlign="Center" importance="High" demandPopin="true" minScreenWidth="Desktop">
                            <customData>
                                <core:CustomData key="p13nData" value='\{"columnKey": "Status","columnIndex":"16", "leadingProperty": "Status", "filterProperty": "Status", "sortProperty": "Status", "type": "string"}'/>
                            </customData>
                            <Text text="{i18n>reconciliationDetail.Status}"/>
                        </Column>
                    </columns>
                    <items>
                        <ColumnListItem vAlign="Middle">
                            <cells>
                                <Text text="{CompanyCode}"/>
                                <Text text="{DocumentNo}"/>
                                <Text text="{FiscalYear}"/>
                                <Text text="{path: 'PostingDate', type: 'sap.ui.model.type.Date', formatOptions: {style: 'medium'}}"/>
                                <Text text="{TaxCode}"/>
                                <Text text="{Currencycode}"/>
                                <ObjectNumber number="{VatrBaseAmount}" unit="{Currencycode}"/>
                                <ObjectNumber number="{VatrTaxAmount}" unit="{Currencycode}"/>
                                <ObjectNumber number="{VatrGrossAmount}" unit="{Currencycode}"/>
                                <ObjectNumber number="{EcslBaseAmount}" unit="{Currencycode}"/>
                                <ObjectNumber number="{EcslTaxAmount}" unit="{Currencycode}"/>
                                <ObjectNumber number="{EcslGrossAmount}" unit="{Currencycode}"/>
                                <ObjectNumber number="{DiffBaseAmount}" unit="{Currencycode}" state="{path: 'DiffBaseAmount', formatter: '.formatter.formatDiffAmountState'}"/>
                                <ObjectNumber number="{DiffTaxAmount}" unit="{Currencycode}" state="{path: 'DiffTaxAmount', formatter: '.formatter.formatDiffAmountState'}"/>
                                <ObjectNumber number="{DiffGrossAmount}" unit="{Currencycode}" state="{path: 'DiffGrossAmount', formatter: '.formatter.formatDiffAmountState'}"/>
                                <ObjectStatus text="{Status}" state="{path: 'Status', formatter: '.formatter.formatStatusColor'}"/>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
            </smartTable:SmartTable>
        </f:content>
    </f:DynamicPage>
</mvc:View>
