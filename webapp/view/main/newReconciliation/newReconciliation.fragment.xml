<core:FragmentDefinition xmlns:mvc="sap.ui.core.mvc"
    xmlns:html="http://www.w3.org/1999/xhtml"
    xmlns="sap.m"
    xmlns:form="sap.ui.layout.form"
    xmlns:core="sap.ui.core"
    xmlns:sv="sap.ui.comp.smartvariants"
    xmlns:sfb="sap.ui.comp.smartfilterbar"
    xmlns:vhd="sap.ui.comp.valuehelpdialog"
    xmlns:fb="sap.ui.comp.filterbar"
    displayBlock="true">
    <Dialog 
        id="ReconciliationDialog" 
        title="{i18n>reconciliationPopup.NewReconciliation}"
        showHeader="true" 
        resizable="false" 
        contentHeight="auto" 
        contentWidth="420px" 
        busyIndicatorDelay="{view>/busyIndicatorDelay}">
        <content>
            <VBox width="96%" class="sapUiTinyMarginTop sapUiTinyMarginBegin sapUiTinyMarginEnd">
                <sv:SmartVariantManagement 
                    class="sapUiSmallMarginBegin" 
                    id="reconciliationSmartVariantManagement" 
                    persistencyKey="tech.taxera.taxreporting.verecon.reconciliation.vm" 
                    showShare="true" 
                    showExecuteOnSelection="true" 
                    entitySet="NewRecParameter"/>
                   
                <sfb:SmartFilterBar 
                    search="onReconciliationSearch" 
                    class="SFDialogContent reconciliationSingleColumnFilterBar" 
                    id="reconciliationSmartFilterBar" 
                    showClearOnFB="false" 
                    showGoOnFB="false" 
                    showFilterConfiguration="false" 
                    liveMode="false" 
                    smartVariant="reconciliationSmartVariantManagement" 
                    useToolbar="false" 
                    entitySet="NewRecParameter" 
                    persistencyKey="tech.taxera.taxreporting.verecon.reconciliation.vm" 
                    assignedFiltersChanged="onReconciliationAssignedFiltersChanged" 
                    enableBasicSearch="false"
                    considerSelectionVariants="false">
                    <sfb:controlConfiguration>
                        <sfb:ControlConfiguration 
                            key="country" 
                            mandatory="mandatory" 
                            index="1" 
                            visibleInAdvancedArea="true">
                            <sfb:customControl>
                                <MultiInput 
                                    id="reconciliationCountryListInput" 
                                    valueHelpOnly="true" 
                                    valueHelpRequest="onReconciliationCountryValueHelpRequest" 
                                    showValueHelp="true" 
                                    placeholder="{i18n>reconciliationPopup.SelectCountry}" 
                                    enableMultiLineMode="true"
                                    maxTokens="1"/>
                            </sfb:customControl>
                        </sfb:ControlConfiguration>
                        <sfb:ControlConfiguration 
                            key="companycode" 
                            mandatory="mandatory" 
                            index="2" 
                            visibleInAdvancedArea="true">
                            <sfb:customControl>
                                <MultiInput 
                                    id="reconciliationCompanyCodeListInput" 
                                    valueHelpOnly="true" 
                                    valueHelpRequest="onReconciliationCompanyCodeValueHelpRequest" 
                                    showValueHelp="true" 
                                    placeholder="{i18n>reconciliationList.SelectCompanyCodes}" 
                                    enableMultiLineMode="true"/>
                            </sfb:customControl>
                        </sfb:ControlConfiguration>
                        <sfb:ControlConfiguration 
                            key="reporting_date" 
                            mandatory="mandatory" 
                            index="3" 
                            visibleInAdvancedArea="true" 
                            conditionType="{
                                module: 'sap.ui.comp.config.condition.DateRangeType',
                                ignoreTime: true,
                                utc: true
                            }">
                        </sfb:ControlConfiguration>
                    </sfb:controlConfiguration>
                    <sfb:customData>
                        <core:CustomData key="dateFormatSettings" value='\{"UTC":true\}' />
                    </sfb:customData>
                    <sfb:layoutData>
                        <FlexItemData shrinkFactor="0"/>
                    </sfb:layoutData>
                    <sfb:dependents>
                        <!-- Value Help Dialog for Countries -->
                        <vhd:ValueHelpDialog id="reconciliationCountryValueHelpDialog" 
                            title="{i18n>reconciliationPopup.SelectCountry}"
                            ok="onReconciliationCountryValueHelpOk"
                            cancel="onReconciliationCountryValueHelpCancel"
                            afterClose="onReconciliationCountryValueHelpAfterClose"
                            key="Country"
                            descriptionKey="Country_Text"
                            supportMultiselect="false">
                            <vhd:filterBar>
                                <fb:FilterBar id="reconciliationCountryFilterBar" 
                                    search="onReconciliationCountryValueHelpSearch"
                                    showClearButton="true"
                                    showRestoreButton="false"
                                    useToolbar="false">
                                    <fb:filterItems>
                                        <fb:FilterItem name="basicSearch" label="">
                                            <fb:control>
                                                <SearchField name="basicSearch" 
                                                    placeholder="Search"
                                                    search="onReconciliationCountryValueHelpSearch"/>
                                            </fb:control>
                                        </fb:FilterItem>
                                    </fb:filterItems>
                                </fb:FilterBar>
                            </vhd:filterBar>
                        </vhd:ValueHelpDialog>
                        
                        <!-- Value Help Dialog for Company Codes -->
                        <vhd:ValueHelpDialog id="reconciliationCompanyCodeValueHelpDialog" 
                            title="{i18n>reconciliationList.SelectCompanyCodes}"
                            ok="onReconciliationCompanyCodeValueHelpOk"
                            cancel="onReconciliationCompanyCodeValueHelpCancel"
                            afterClose="onReconciliationCompanyCodeValueHelpAfterClose"
                            key="CompanyCode"
                            descriptionKey="Name"
                            supportMultiselect="true">
                            <vhd:filterBar>
                                <fb:FilterBar id="reconciliationCompanyCodeFilterBar" 
                                    search="onReconciliationCompanyCodeValueHelpSearch"
                                    showClearButton="true"
                                    showRestoreButton="false"
                                    useToolbar="false">
                                    <fb:filterItems>
                                        <fb:FilterItem name="basicSearch" label="">
                                            <fb:control>
                                                <SearchField name="basicSearch" 
                                                    placeholder="Search"
                                                    search="onReconciliationCompanyCodeValueHelpSearch"/>
                                            </fb:control>
                                        </fb:FilterItem>
                                    </fb:filterItems>
                                </fb:FilterBar>
                            </vhd:filterBar>
                        </vhd:ValueHelpDialog>
                    </sfb:dependents>
                </sfb:SmartFilterBar>
            </VBox>
        </content>
        <buttons>
            <Button 
                text="{i18n>reconciliationPopup.Proceed}" 
                type="Emphasized" 
                press="onNewReconciliationProceed"/>
            <Button 
                text="{i18n>reconciliationPopup.Cancel}" 
                press="onNewReconciliationCancel"/>
        </buttons>
    </Dialog>
</core:FragmentDefinition>
