<core:FragmentDefinition xmlns:mvc="sap.ui.core.mvc"
    xmlns:html="http://www.w3.org/1999/xhtml"
    xmlns="sap.m"
    xmlns:sform="sap.ui.comp.smartform"
    xmlns:form="sap.ui.layout.form"
    xmlns:smartField="sap.ui.comp.smartfield"
    xmlns:core="sap.ui.core"
    xmlns:vhd="sap.ui.comp.valuehelpdialog"
    displayBlock="true">
    <Dialog id="ReconciliationDialog" showHeader="false" resizable="false" contentHeight="auto" contentWidth="500px" busyIndicatorDelay="{view>/busyIndicatorDelay}">
        <headerToolbar>
            <Toolbar>
                <Title text="{i18n>reconciliationPopup.NewReconciliation}"/>
                <ToolbarSpacer/>
                <Label text="{i18n>reconciliationPopup.Variant}" labelFor="reconciliationVariantSelect" class="sapUiTinyMarginEnd"/>
                <Select 
                    id="reconciliationVariantSelect" 
                    width="200px"
                    change="onReconciliationVariantChange"
                    items="{
                        path: 'view>/reconciliationList/newReconciliation/variants',
                        templateShareable: false
                    }">
                    <core:Item key="{view>key}" text="{view>text}"/>
                </Select>
                <Button 
                    icon="sap-icon://save" 
                    tooltip="{i18n>reconciliationPopup.SaveVariant}" 
                    press="onSaveReconciliationVariant"
                    type="Transparent"/>
                <Button 
                    icon="sap-icon://action-settings" 
                    tooltip="{i18n>reconciliationPopup.ManageVariants}" 
                    press="onManageReconciliationVariants"
                    type="Transparent"/>
            </Toolbar>
        </headerToolbar>
        <form:Form editable="true">
            <form:layout>
                <form:ColumnLayout columnsM="1" columnsL="1" columnsXL="1"/>
            </form:layout>
            <form:FormContainer>
                <form:FormElement>
                    <form:label>
                        <Label text="{i18n>reconciliationList.CountryList}" required="true"/>
                    </form:label>
                    <MultiInput 
                        id="reconciliationCountryListInput" 
                        valueHelpOnly="true" 
                        valueHelpRequest="onReconciliationCountryValueHelpRequest" 
                        showValueHelp="true" 
                        placeholder="{i18n>reconciliationList.SelectCountries}" 
                        enableMultiLineMode="true"
                        valueState="{view>/reconciliationList/newReconciliation/CountryListValueState}"
                        valueStateText="{view>/reconciliationList/newReconciliation/CountryListValueStateText}"/>
                </form:FormElement>
                <form:FormElement>
                    <form:label>
                        <Label text="{i18n>reconciliationList.CompanyCodeList}" required="true"/>
                    </form:label>
                    <MultiInput 
                        id="reconciliationCompanyCodeListInput" 
                        valueHelpOnly="true" 
                        valueHelpRequest="onReconciliationCompanyCodeValueHelpRequest" 
                        showValueHelp="true" 
                        placeholder="{i18n>reconciliationList.SelectCompanyCodes}" 
                        enableMultiLineMode="true"
                        valueState="{view>/reconciliationList/newReconciliation/CompanyCodeListValueState}"
                        valueStateText="{view>/reconciliationList/newReconciliation/CompanyCodeListValueStateText}"/>
                </form:FormElement>
            </form:FormContainer>
        </form:Form>
        <form:Form editable="true" class="sapUiSmallMargin">
            <form:layout>
                <form:ColumnLayout columnsM="1" columnsL="1" columnsXL="1"/>
            </form:layout>
            <form:FormContainer>
                <form:FormElement>
                    <form:label>
                        <Label text="{i18n>reconciliationPopup.DateRange}" required="true"/>
                    </form:label>
                    <DateRangeSelection 
                        id="reconciliationDateRangeInput"
                        value="{parts: [{path: 'FromDate'}, {path: 'ToDate'}], type: 'sap.ui.model.type.DateInterval', formatOptions: { UTC: true}}" 
                        displayFormat="short" 
                        change="onReconciliationDateRangeChange"
                        valueState="{view>/reconciliationList/newReconciliation/dateRangeValueState}"
                        valueStateText="{view>/reconciliationList/newReconciliation/dateRangeValueStateText}"/>
                </form:FormElement>
            </form:FormContainer>
        </form:Form>
        <buttons>
            <Button text="{i18n>reconciliationPopup.Proceed}" type="Accept" press="onNewReconciliationProceed"></Button>
            <Button text="{i18n>reconciliationPopup.Cancel}" type="Reject" press="onNewReconciliationCancel"></Button>
        </buttons>
        <dependents>
            <!-- Value Help Dialog for Countries -->
            <vhd:ValueHelpDialog id="reconciliationCountryValueHelpDialog" 
                title="{i18n>reconciliationList.SelectCountries}"
                ok="onReconciliationCountryValueHelpOk"
                cancel="onReconciliationCountryValueHelpCancel"
                afterClose="onReconciliationCountryValueHelpAfterClose"
                key="Country"
                descriptionKey="Country_Text"
                supportMultiselect="true"/>
            
            <!-- Value Help Dialog for Company Codes -->
            <vhd:ValueHelpDialog id="reconciliationCompanyCodeValueHelpDialog" 
                title="{i18n>reconciliationList.SelectCompanyCodes}"
                ok="onReconciliationCompanyCodeValueHelpOk"
                cancel="onReconciliationCompanyCodeValueHelpCancel"
                afterClose="onReconciliationCompanyCodeValueHelpAfterClose"
                key="CompanyCode"
                descriptionKey="Name"
                supportMultiselect="true"/>
            
            <!-- Manage Variants Dialog -->
            <Dialog id="reconciliationManageVariantsDialog" 
                title="{i18n>reconciliationPopup.ManageVariants}"
                contentWidth="400px">
                <content>
                    <List 
                        id="reconciliationVariantsList"
                        mode="Delete"
                        delete="onDeleteReconciliationVariant"
                        items="{
                            path: 'view>/reconciliationList/newReconciliation/manageVariants',
                            templateShareable: false
                        }">
                        <StandardListItem 
                            title="{view>text}"
                            type="Active"
                            press="onSelectReconciliationVariantFromManage"/>
                    </List>
                </content>
                <buttons>
                    <Button text="{i18n>common.OK}" press="onCloseManageVariantsDialog"/>
                </buttons>
            </Dialog>
        </dependents>
    </Dialog>
</core:FragmentDefinition>
